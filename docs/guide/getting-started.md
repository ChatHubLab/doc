# 快速开始

接下来就让我们开始初步的安装，配置与使用 chathub 吧！

## 安装

### 安装 Koishi

::: tip
在安装 Koishi 前，你需要检查你的 Node 版本。Koishi 本身要求最低在 Node 14 上运行。但本项目的依赖库需求的最低版本为 Node 18。因此如果你需要使用本项目，你需要确保你的 Node 版本在 18 以上。

你可以使用 `node -v` 来检查你的 Node 版本。

还需要注意的是，截止目前 `1.0.0-alpha.0` 版本，我们需求的最低Koishi版本为 `4.13.0`。因此你需要确保你的 Koishi 版本在 `4.13.0` 以上。
:::

首先你需要安装 Koishi，你可以参考 [Koishi 官方文档](https://koishi.chat/zh-CN/manual/starter/) 来安装 Koishi。

当你成功的安装了 koishi 后，并且成功的运行了 Koishi，你可以继续下一步。

### 配置 Koishi

安装好 Koishi 后，你还不能直接开始安装此插件，你需要接入真实聊天平台才能在真实环境下和插件聊天。点击 [这里](https://koishi.chat/zh-CN/manual/console/adapter.html) 查看如何接入聊天平台。

你可以选择暂时不接入，这样你仍然可以在 [沙盒](https://koishi.chat/zh-CN/manual/console/sandbox.html) 里使用此插件。

（我们推荐你在配置好任何插件后先在沙盒环境里测试插件是否正常运行）

### 前置插件

当你成功的安装了 Koishi 并接入了聊天平台后，你还不能立即开始安装此插件。

由于 Koishi 丰富的 API 与生态，一个插件为了实现一个功能，并不总是自己全部实现，而是通过调用其他插件的 API 来实现。这样做的好处是，插件开发者可以专注于自己的功能，而不用去实现一些基础的功能。

接下来就是安装此插件的依赖前置插件。

:::tip
在 Koishi 控制台里，安装了插件后 Koishi 会自动创建该插件的空配置项，并跳转到配置页面，默认为未启用插件状态。

你需要配置好插件的配置项后，才能启用插件。

配置好插件的配置项后，点击右上角的三角形按钮（也就是启用按钮）来启用插件。
请务必注意，如果你没有配置好插件的配置项，启用插件后可能会导致插件无法正常运行。
:::

#### (必须) 提供了 database 服务的插件

database 服务是此插件的必须服务依赖，它提供了对数据库的相关操作。

我们使用此服务来存储对话信息等持久化内容。

打开 Koishi 控制台，前往插件市场搜索`impl:database`，然后安装你偏好的数据库平台支持插件。

![搜索后的结果](/images/plugin_market_2.png)

对于大部分场景，我们推荐你使用`database-sqlite`，它轻量，并且无需额外配置，几乎是安装后开箱即用。

如果你需要使用其他的数据平台支持插件，并且你安装插件后不知道如何配置的话，你可能需要前往 [Koishi 论坛](https://forum.koishi.xyz/) 寻求如何配置相关的插件。

::: tip
在大部分的安装 Koishi 方式中，安装 Koishi 后很可能会内置`database-sqlite`插件，如果你不需要配置其他数据库的话，你可以跳过这一步。
:::

#### (必须) 安装提供了 cache 服务的插件

cache 服务是此插件的必须服务依赖，它提供了对缓存键值对的相关操作。

我们使用此服务来存储某些短期配置项，如默认模型等。

打开 Koishi 控制台，前往插件市场搜索`impl:cache`，然后安装你偏好的缓存平台支持插件。

![搜索后的结果](/images/plugin_market_3.png)

对于大部分场景，我们推荐你使用`cache-database`，它几乎无需额外配置，只需要你按照上面的要求安装了提供 database 服务的插件，然后完全可以安装后开箱即用。

如果你需要使用其他的数据平台支持插件，并且你安装插件后不知道如何配置的话，你可能需要前往 [Koishi 论坛](https://forum.koishi.xyz/) 寻求如何配置相关的插件。

::: tip
我们需求的 cache 服务的相关版本为 `2.0.0.alpha.0`，请不要安装 `1.x` 版本，目前插件已不再兼容 `1.x` 版本。
:::

#### (可选) 安装 puppeteer 插件

puppetter 插件是此插件的可选服务依赖，它提供了 puppeteer 的相关服务，使得插件可以调用浏览器，实现很多操作。（如网页截图实现本地html渲染）

我们使用此服务来实现生成图片回复。如果你不安装提供了此服务的插件，你将无法使用回复模式里的图片模式。

打开 Koishi 控制台，前往插件市场搜索 `impl:puppeteer`，然后安装puppeteer 插件。

安装完成后你需要配置此插件，具体的插件配置项可以查看 [这里](https://puppeteer.koishi.chat/)，我们不在这里赘述。

#### (可选) 安装提供了 censor 服务的插件

censor 服务是此插件的可选服务依赖，它提供了内容安全过滤的服务。

我们使用此服务来实现回复内容安全过滤。

打开 Koishi 控制台，前往插件市场搜索`category:censor`，然后安装你偏好的内容安全过滤平台支持插件。

安装完成后你需要配置相关插件才能使用，具体的插件配置项可以查看 [这里](https://censor.koishi.chat/)，我们不在这里赘述。

::: tip
需要注意的是，有的插件虽然也提供 censor 服务， 但是它只对图像做审核，不会对文本内容做审核！因此你需要确保你安装的插件支持对文本内容的审核。
:::

#### （可选）安装提供了 vits 服务的插件

vits 服务是此插件的可选服务依赖，它提供了文本转语音的相关服务。

我们使用此服务来实现生成语音回复。如果你不安装提供了此服务的插件，你将无法使用回复模式里的语音模式。

打开 Koishi 控制台，前往插件市场搜索`impl:vits`，然后安装你偏好的文本转语音平台支持插件。

![搜索后的结果](/images/plugin_market_5.png)

安装后你可能还需要配置相关插件才能使用，具体怎么使用可以查看插件的配置项的描述，或插件主页。（当然你也可以直接联系插件的作者问）

:::tip
我们推荐安装`open-vits`插件，这是可开箱即用的提供了 vits 服务的插件，插件由 [initialencounter](https://github.com/initialencounter) 编写，并且后端是由 [t4wefan](https://github.com/t4wefan) 免费提供的公益 vits 后端，感谢他们的插件和后端提供能让 vits 服务的使用没有门槛！
:::

### 安装主插件

::: tip
主插件指的就是 `@dingyi222666/chathub` 插件本体。该插件提供了 chathub 的服务，核心功能，扩展 API等。在下文以及后续的文章中我们将使用主插件来指代 `@dingyi222666/chathub` 插件本体。
:::

在安装和配置了这么多前置插件后，终于可以开始安装 chathub 的主插件了！

但请注意，安装完成后插件本体并不能直接使用哦。前面有提到 chathub 的扩展性，这种扩展性也体现在插件本身的设计上。主插件本体没有任何模型/平台的接入。所有的接入都是通过其他的 Koishi 插件，调用主插件的扩展 API 来实现的。

打开 Koishi 控制台，前往插件市场搜索`@dingyi222666/chathub`，然后安装 主插件。

![搜索后的结果](/images/plugin_market_1.png)

安装完成后启用就可以了！当然我们还需要配置插件，在下面的配置章节会详细介绍。

### 安装一个或多个模型平台适配器插件

前面讲到了 chathub 插件本身没有任何模型平台的接入，所有的接入都是通过其他的 Koishi 插件，调用主插件的扩展 API 来实现的。

接下来我们就要安装模型平台适配器插件了。

打开 Koishi 控制台，前往插件市场搜索`@dingyi222666/chathub` + 空格 + `adapter` + 空格，然后安装你偏好的模型/平台适配器插件。

![搜索后的结果](/images/plugin_market_6.png)

:::tip
你可以同时安装多个模型平台适配器插件，只需要使用命令即可切换不同的模型平台来使用。
:::

安装了相关的适配器插件后，你还需要配置插件，在接下来的教程里我们只会简单介绍怎么配置`OpenAI`的适配器插件。

其他的模型平台的配置教程可以在文档的 [配置模型平台](/guide/configure-model-platform) 章节查看。

## 配置

### 配置主插件

在此章节我们只会简单介绍怎么配置主插件。
具体的配置项可以在 [配置项](/guide/configurations/core) 章节查看。

打开 Koishi 控制台，前往插件配置，找到`@dingyi222666/chathub`插件，然后点击进入配置页面。

:::tip
如果你安装了插件但是在插件配置页找不到插件的话，很可能是没有添加插件配置项，你可以在插件配置页点击到`全局设置`页面，然后点击右上角的`添加插件`按钮来添加插件。这将会添加你选择添加插件的一个新的空配置项。
:::

接下来我们会介绍几个基础但是很有用的配置项。其他配置项你可以在 [配置项](/guide/configurations/core) 章节查看。

#### isProxy

- 类型：boolean
- 默认值：false

是否使用代理配置。此配置影响到所有使用主插件相关网络请求 API 的插件。
由于各种原因，使用大部分的模型平台的 API 都需要使用代理，因此我们强烈建议你开启此配置项。

#### proxyAddress

- 类型: string (url)
- 默认值: ''

代理地址。此配置影响到所有使用主插件相关网络请求 API 的插件。
此配置项只有在`isProxy`为`true`时才会显示（否则此配置项会被隐藏）。

目前我们支持 `http` 和 `socks5` 代理，你可以在此配置项里填写你的代理地址。

:::tip
需要注意的是，在填写代理地址时，你需要填写完整的代理地址，包括协议，端口等。
例如`http://localhost:7890`

请不要忘记填写协议名！！！之前就有不少人使用了`localhost:7890`这样的地址，导致插件无法正常使用代理，进而导致插件无法正常使用。
:::

#### msgCooldown

- 类型: number (seconds)
- 默认值: 5

全局的消息冷却时间。所有的命令执行都会受到此配置项的影响。
大量的命令执行可能会导致模型的并发请求过多（甚至能导致相关账号被封禁），因此我们建议你设置一个合理的冷却时间。

#### outputMode

- 类型: 'raw' | 'voice' | 'text' | 'image' | 'mixed'
- 默认值: 'text'

消息的输出格式。

#### 类型值详细说明

- 'raw' (即为配置项的原始模式)
    原始的输出格式，不做任何处理。

- 'voice' (即为配置项的语音模式)

    语音模式，将会使用 vits 服务来将模型生成的文本转为语音输出。

- 'text' (即为配置项的文本模式)
    文本模式，将会使用 [koishi-plugin-markdown](https://markdown.koishi.chat/) 来解析模型生成的文本，然后输出。
    （由于大部分模型都支持甚至默认生成 markdown 格式的文本，因此我们推荐使用此模式）

- 'image' (即为配置项的图像模式)

    图片模式，将会使用 [marked](https://marked.js.org/) 来渲染模型生成的 arkdown 格式的文本为 html，使用 [puppeteer](https://puppeteer.koishi.chat/) 服务来将渲染成图片，然后输出。
    图片生成后我们同时也会将原始文本上传到 [Mozilla's Community Pastebin](https://pastebin.mozilla.org/)，并将上传后得到的链接以二维码的形式附加到图片上，方便用户查看原始文本）
- 'mixed' (即为配置项的混合模式)

    混合模式，将会使用 [marked](https://marked.js.org/) 来解析模型生成的 markdown 格式的文本，将解析后的文本分割成多条消息块，决定每个消息块是否需要渲染成图片（否则渲染成文本），然后输出。

基础配置完成后，你就可以启用主插件了。

### 配置 (OpenAI) 模型平台

在此章节我们只会简单介绍怎么配置`OpenAI`的适配器插件。
其他的模型平台的配置教程可以在文档的 [配置模型平台](/guide/configure-model-platform) 章节查看。

前置要求：

- 你需要有一个 OpenAI 的 API Key，并且保证此 API Key 拥有可用额度。

    如果你没有的话，你可以自行搜索教程来了解如何获取。

- 你需要有条件能访问到`api.openai.com`，包括使用代理，或使用反代了OpenAI的API的服务。
    需要注意的是，直接使用代理访问OpenAI 的 API 服务可能会含有一定的风险，你需要检查你的代理的IP地址的纯净度。

    如果你使用的代理，你需要在主插件里配置`isProxy`为`true`，并且配置`proxyAddress`为你的代理地址。

接下来我们就可以开始配置了。

打开 Koishi 控制台，前往插件配置，找到`@dingyi222666/chathub-adapter-openai`插件，然后点击进入配置页面。

对于快速上手，我们只需要关注`请求设置`的相关配置项即可。详细的配置项可以在 [配置项](/guide/configure-model-platform/openai) 章节查看。

#### apiKey

- 类型: string
- 默认值: ''
- 是否必须: 是

OpenAI 的 API Key。你需要填写你的 OpenAI 的 API Key。否则插件将无法正常使用。

#### apiEndPoint

- 类型: string (url)
- 默认值: `https://api.openai.com/v1`
- 是否必须: 是

请求 OpenAI 的 API 的基础域名地址。此配置通常用于设置反代了OpenAI的API的服务地址。如果你使用的是代理，你可以不用配置此项。

如果你使用的是反代了OpenAI的API的服务，你需要填写你的反代服务的地址。
需要注意的是，在填写反代服务的地址时，你需要加上`/v1`后缀。例如`https://api.openai-proxy.com/v1`

基础配置`OpenAI`的适配器插件完成后，你就可以启用此插件了。

:::tip
接入到 chathub 的模型平台插件，在第一次启用时，都需要先启用主插件，然后再启用模型平台插件。（后续都要启用相关插件）请务必注意启用顺序。
:::

你可以使用`chathub.listmodel` (或`模型列表`)命令来查看当前已经安装的模型平台插件。
只要能列出以`openai`为前缀的模型，就说明你已经成功的安装了`OpenAI`的适配器插件。

![执行了模型列表命令的结果](/images/model_list_1.png)

### 配置默认模型

如果你按照了上述的步骤来安装和配置插件，那么你现在基本已经可以使用插件了。

但是...，是的，还没有结束！

当你配置好了主插件和平台插件时，兴冲冲的使用`聊天`命令尝试一番，你只会得到这样的结果：

![执行了聊天命令的结果](/images/error_1.png)

由于你没有设置任何一个模型为默认模型，因此插件并不知道你想使用哪个模型来聊天。

在`0.x`版本中，每个模型/平台插件都会提供一个`isDefault`配置项，你可以在配置此配置项为`true`来设置此模型为默认模型。

但在`1.x`版本中，我们将此配置项移除了，因为我们认为这样的设计并不合理。这会导致每个插件都要设置在自己插件里的默认模型。

我们使用`chathub.setmodel`(或`设置模型`)命令来设置默认模型。

首先需要向 Bot 执行一次`chathub.listmodel`(或`模型列表`)命令，来查看当前已经安装的模型平台插件。

例如：
![执行了模型列表命令的结果](/images/model_list_1.png)

使用`chathub.setmodel`(或`设置模型`)命令来设置默认模型：
![执行了设置模型命令的结果](/images/set_model_1.png)

## 聊天

接下来就可以使用`chathub.chat`(或`聊天`)命令来和模型聊天了！
![执行了聊天命令的结果](/images/chat_openai_1.png)

通过上面的快速上手教程，你已经成功的安装了此插件，并且成功的和模型对话了！

## 接下来

然而我知道你还有很多疑问，比如：

- 如何配置其他模型平台？
- 如何配置预设？

接下来你可以自由的按照侧边栏的文章教程来学习你需要的内容，
或点击页面的下一篇来继续阅读相关教程。
